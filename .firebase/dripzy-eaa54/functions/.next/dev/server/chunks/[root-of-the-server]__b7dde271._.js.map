{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/dasmesh/Documents/Git%20Hub/dropship-store/lib/cj-client.ts"],"sourcesContent":["// CJ Dropshipping API Client\n// Documentation: https://developers.cjdropshipping.cn/en/api/introduction.html\n\nconst BASE_URL = 'https://developers.cjdropshipping.com/api2.0/v1';\n\n// Types for CJ API responses\nexport interface CJProduct {\n    id: string;\n    nameEn: string;\n    sku: string;\n    spu: string;\n    bigImage: string;\n    sellPrice: string;\n    nowPrice?: string;\n    discountPrice?: string;\n    discountPriceRate?: string;\n    listedNum: number;\n    categoryId: string;\n    threeCategoryName?: string;\n    twoCategoryName?: string;\n    oneCategoryName?: string;\n    productType: string;\n    supplierName?: string;\n    warehouseInventoryNum?: number;\n    currency?: string;\n    description?: string;\n    deliveryCycle?: string;\n}\n\nexport interface CJProductDetails {\n    pid: string;\n    productName: string;\n    productNameEn: string;\n    productSku: string;\n    productImage: string;\n    productWeight: string;\n    productUnit: string;\n    productType: string;\n    categoryId: string;\n    categoryName: string;\n    sellPrice: number;\n    description: string;\n    suggestSellPrice: string;\n    listedNum: number;\n    status: string;\n    variants: CJVariant[];\n    createrTime: string;\n}\n\nexport interface CJVariant {\n    vid: string;\n    pid: string;\n    variantNameEn: string;\n    variantSku: string;\n    variantKey: string;\n    variantLength: number;\n    variantWidth: number;\n    variantHeight: number;\n    variantWeight: number;\n    variantSellPrice: number;\n    variantSugSellPrice?: number;\n    inventories?: CJInventory[];\n}\n\nexport interface CJInventory {\n    countryCode: string;\n    totalInventory: number;\n    cjInventory: number;\n    factoryInventory: number;\n}\n\nexport interface CJCategory {\n    categoryFirstName: string;\n    categoryFirstList: {\n        categorySecondName: string;\n        categorySecondList: {\n            categoryId: string;\n            categoryName: string;\n        }[];\n    }[];\n}\n\nexport interface CJAuthTokens {\n    accessToken: string;\n    accessTokenExpiryDate: string;\n    refreshToken: string;\n    refreshTokenExpiryDate: string;\n    createDate: string;\n    openId?: number;\n}\n\nexport interface CJApiResponse<T> {\n    code: number;\n    result: boolean;\n    message: string;\n    data: T;\n    requestId: string;\n    success?: boolean;\n}\n\nexport interface CJProductListResponse {\n    pageSize: number;\n    pageNumber: number;\n    totalRecords: number;\n    totalPages: number;\n    content: {\n        productList: CJProduct[];\n        relatedCategoryList?: { categoryId: string; categoryName: string }[];\n        keyWord?: string;\n    }[];\n}\n\nexport interface ProductSearchParams {\n    page?: number;\n    size?: number;\n    keyWord?: string;\n    categoryId?: string;\n    minPrice?: number;\n    maxPrice?: number;\n    countryCode?: string;\n    sort?: 'priceAsc' | 'priceDesc' | 'listedNumDesc' | 'createAtDesc';\n}\n\nclass CJDropshippingClient {\n    private accessToken: string;\n    private refreshToken: string;\n    private accessTokenExpiry: Date | null;\n    private refreshTokenExpiry: Date | null;\n    private apiKey: string;\n\n    constructor() {\n        this.accessToken = process.env.CJ_ACCESS_TOKEN || '';\n        this.refreshToken = process.env.CJ_REFRESH_TOKEN || '';\n        this.apiKey = process.env.CJ_API_KEY || '';\n        this.accessTokenExpiry = process.env.CJ_ACCESS_TOKEN_EXPIRY\n            ? new Date(process.env.CJ_ACCESS_TOKEN_EXPIRY)\n            : null;\n        this.refreshTokenExpiry = process.env.CJ_REFRESH_TOKEN_EXPIRY\n            ? new Date(process.env.CJ_REFRESH_TOKEN_EXPIRY)\n            : null;\n    }\n\n    /**\n     * Make an authenticated request to CJ API\n     */\n    private async request<T>(\n        endpoint: string,\n        options: RequestInit = {}\n    ): Promise<CJApiResponse<T>> {\n        // Check if we need to refresh the token\n        if (this.shouldRefreshToken()) {\n            await this.refreshAccessToken();\n        }\n\n        if (!this.accessToken) {\n            throw new Error('CJ_ACCESS_TOKEN is not configured. Please add your CJ API credentials to .env.local');\n        }\n\n        const url = endpoint.startsWith('http') ? endpoint : `${BASE_URL}${endpoint}`;\n\n        const res = await fetch(url, {\n            ...options,\n            headers: {\n                'CJ-Access-Token': this.accessToken,\n                'Content-Type': 'application/json',\n                ...options.headers,\n            },\n        });\n\n        const data = await res.json();\n\n        if (!res.ok || data.code !== 200) {\n            console.error('CJ API Error:', data);\n            throw new Error(data.message || `CJ API Error: ${res.statusText}`);\n        }\n\n        return data;\n    }\n\n    /**\n     * Check if access token needs refresh (within 1 day of expiry)\n     */\n    private shouldRefreshToken(): boolean {\n        if (!this.accessTokenExpiry) return false;\n        const oneDayFromNow = new Date(Date.now() + 24 * 60 * 60 * 1000);\n        return this.accessTokenExpiry < oneDayFromNow;\n    }\n\n    /**\n     * Get new access token using API key\n     */\n    async getAccessToken(): Promise<CJAuthTokens> {\n        if (!this.apiKey) {\n            throw new Error('CJ_API_KEY is not configured');\n        }\n\n        const res = await fetch(`${BASE_URL}/authentication/getAccessToken`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({ apiKey: this.apiKey }),\n        });\n\n        const data: CJApiResponse<CJAuthTokens> = await res.json();\n\n        if (!data.result || data.code !== 200) {\n            throw new Error(data.message || 'Failed to get access token');\n        }\n\n        this.accessToken = data.data.accessToken;\n        this.refreshToken = data.data.refreshToken;\n        this.accessTokenExpiry = new Date(data.data.accessTokenExpiryDate);\n        this.refreshTokenExpiry = new Date(data.data.refreshTokenExpiryDate);\n\n        return data.data;\n    }\n\n    /**\n     * Refresh access token using refresh token\n     */\n    async refreshAccessToken(): Promise<CJAuthTokens> {\n        if (!this.refreshToken) {\n            throw new Error('No refresh token available. Please get a new access token.');\n        }\n\n        const res = await fetch(`${BASE_URL}/authentication/refreshAccessToken`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({ refreshToken: this.refreshToken }),\n        });\n\n        const data: CJApiResponse<CJAuthTokens> = await res.json();\n\n        if (!data.result || data.code !== 200) {\n            // Refresh token may be expired, need to get new tokens\n            throw new Error('Refresh token expired. Please get a new access token using API key.');\n        }\n\n        this.accessToken = data.data.accessToken;\n        this.refreshToken = data.data.refreshToken;\n        this.accessTokenExpiry = new Date(data.data.accessTokenExpiryDate);\n        this.refreshTokenExpiry = new Date(data.data.refreshTokenExpiryDate);\n\n        return data.data;\n    }\n\n    /**\n     * Get product categories from CJ\n     */\n    async getCategories(): Promise<CJCategory[]> {\n        const response = await this.request<CJCategory[]>('/product/getCategory', {\n            method: 'GET',\n        });\n        return response.data;\n    }\n\n    /**\n     * Search/List products using V2 API (better performance with Elasticsearch)\n     */\n    async searchProducts(params: ProductSearchParams = {}): Promise<CJProductListResponse> {\n        const queryParams = new URLSearchParams();\n\n        if (params.page) queryParams.append('page', params.page.toString());\n        if (params.size) queryParams.append('size', params.size.toString());\n        if (params.keyWord) queryParams.append('keyWord', params.keyWord);\n        if (params.categoryId) queryParams.append('categoryId', params.categoryId);\n        if (params.minPrice) queryParams.append('minPrice', params.minPrice.toString());\n        if (params.maxPrice) queryParams.append('maxPrice', params.maxPrice.toString());\n        if (params.countryCode) queryParams.append('countryCode', params.countryCode);\n        if (params.sort) queryParams.append('sort', params.sort);\n\n        const response = await this.request<CJProductListResponse>(\n            `/product/listV2?${queryParams.toString()}`,\n            { method: 'GET' }\n        );\n        return response.data;\n    }\n\n    /**\n     * Get product details by product ID\n     */\n    async getProductDetails(pid: string): Promise<CJProductDetails> {\n        const response = await this.request<CJProductDetails>(\n            `/product/query?pid=${pid}`,\n            { method: 'GET' }\n        );\n        return response.data;\n    }\n\n    /**\n     * Get list of products saved to \"My Products\" in CJ account\n     */\n    async getMyProducts(params: { page?: number; size?: number; keyword?: string } = {}): Promise<CJProductListResponse> {\n        const queryParams = new URLSearchParams();\n\n        if (params.page) queryParams.append('page', params.page.toString());\n        if (params.size) queryParams.append('size', params.size.toString());\n        if (params.keyword) queryParams.append('keyword', params.keyword);\n\n        const response = await this.request<CJProductListResponse>(\n            `/product/myProduct/query?${queryParams.toString()}`,\n            { method: 'GET' }\n        );\n        return response.data;\n    }\n\n    /**\n     * Add a product to \"My Products\" in CJ account\n     */\n    async addToMyProducts(productId: string): Promise<boolean> {\n        const response = await this.request<{ success: boolean }>(\n            '/product/addToMine',\n            {\n                method: 'POST',\n                body: JSON.stringify({ productId }),\n            }\n        );\n        return response.result;\n    }\n\n    /**\n     * Get product inventory by variant IDs\n     */\n    async getInventory(variantIds: string[]): Promise<CJInventory[]> {\n        const response = await this.request<CJInventory[]>(\n            '/product/inventory/query',\n            {\n                method: 'POST',\n                body: JSON.stringify({ variantIds }),\n            }\n        );\n        return response.data;\n    }\n\n    /**\n     * Update client tokens (e.g., after manual refresh)\n     */\n    setTokens(accessToken: string, refreshToken?: string): void {\n        this.accessToken = accessToken;\n        if (refreshToken) {\n            this.refreshToken = refreshToken;\n        }\n    }\n}\n\n// Singleton instance\nexport const cjClient = new CJDropshippingClient();\n\n// Export class for testing or creating new instances\nexport { CJDropshippingClient };\n"],"names":[],"mappings":";;;;;;AAAA,6BAA6B;AAC7B,+EAA+E;AAE/E,MAAM,WAAW;AAwHjB,MAAM;IACM,YAAoB;IACpB,aAAqB;IACrB,kBAA+B;IAC/B,mBAAgC;IAChC,OAAe;IAEvB,aAAc;QACV,IAAI,CAAC,WAAW,GAAG,QAAQ,GAAG,CAAC,eAAe,IAAI;QAClD,IAAI,CAAC,YAAY,GAAG,QAAQ,GAAG,CAAC,gBAAgB,IAAI;QACpD,IAAI,CAAC,MAAM,GAAG,QAAQ,GAAG,CAAC,UAAU,IAAI;QACxC,IAAI,CAAC,iBAAiB,GAAG,QAAQ,GAAG,CAAC,sBAAsB,GACrD,IAAI,KAAK,QAAQ,GAAG,CAAC,sBAAsB,IAC3C;QACN,IAAI,CAAC,kBAAkB,GAAG,QAAQ,GAAG,CAAC,uBAAuB,GACvD,IAAI,KAAK,QAAQ,GAAG,CAAC,uBAAuB,IAC5C;IACV;IAEA;;KAEC,GACD,MAAc,QACV,QAAgB,EAChB,UAAuB,CAAC,CAAC,EACA;QACzB,wCAAwC;QACxC,IAAI,IAAI,CAAC,kBAAkB,IAAI;YAC3B,MAAM,IAAI,CAAC,kBAAkB;QACjC;QAEA,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;YACnB,MAAM,IAAI,MAAM;QACpB;QAEA,MAAM,MAAM,SAAS,UAAU,CAAC,UAAU,WAAW,GAAG,WAAW,UAAU;QAE7E,MAAM,MAAM,MAAM,MAAM,KAAK;YACzB,GAAG,OAAO;YACV,SAAS;gBACL,mBAAmB,IAAI,CAAC,WAAW;gBACnC,gBAAgB;gBAChB,GAAG,QAAQ,OAAO;YACtB;QACJ;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAE3B,IAAI,CAAC,IAAI,EAAE,IAAI,KAAK,IAAI,KAAK,KAAK;YAC9B,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,MAAM,IAAI,MAAM,KAAK,OAAO,IAAI,CAAC,cAAc,EAAE,IAAI,UAAU,EAAE;QACrE;QAEA,OAAO;IACX;IAEA;;KAEC,GACD,AAAQ,qBAA8B;QAClC,IAAI,CAAC,IAAI,CAAC,iBAAiB,EAAE,OAAO;QACpC,MAAM,gBAAgB,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK;QAC3D,OAAO,IAAI,CAAC,iBAAiB,GAAG;IACpC;IAEA;;KAEC,GACD,MAAM,iBAAwC;QAC1C,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;YACd,MAAM,IAAI,MAAM;QACpB;QAEA,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,8BAA8B,CAAC,EAAE;YACjE,QAAQ;YACR,SAAS;gBACL,gBAAgB;YACpB;YACA,MAAM,KAAK,SAAS,CAAC;gBAAE,QAAQ,IAAI,CAAC,MAAM;YAAC;QAC/C;QAEA,MAAM,OAAoC,MAAM,IAAI,IAAI;QAExD,IAAI,CAAC,KAAK,MAAM,IAAI,KAAK,IAAI,KAAK,KAAK;YACnC,MAAM,IAAI,MAAM,KAAK,OAAO,IAAI;QACpC;QAEA,IAAI,CAAC,WAAW,GAAG,KAAK,IAAI,CAAC,WAAW;QACxC,IAAI,CAAC,YAAY,GAAG,KAAK,IAAI,CAAC,YAAY;QAC1C,IAAI,CAAC,iBAAiB,GAAG,IAAI,KAAK,KAAK,IAAI,CAAC,qBAAqB;QACjE,IAAI,CAAC,kBAAkB,GAAG,IAAI,KAAK,KAAK,IAAI,CAAC,sBAAsB;QAEnE,OAAO,KAAK,IAAI;IACpB;IAEA;;KAEC,GACD,MAAM,qBAA4C;QAC9C,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACpB,MAAM,IAAI,MAAM;QACpB;QAEA,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,kCAAkC,CAAC,EAAE;YACrE,QAAQ;YACR,SAAS;gBACL,gBAAgB;YACpB;YACA,MAAM,KAAK,SAAS,CAAC;gBAAE,cAAc,IAAI,CAAC,YAAY;YAAC;QAC3D;QAEA,MAAM,OAAoC,MAAM,IAAI,IAAI;QAExD,IAAI,CAAC,KAAK,MAAM,IAAI,KAAK,IAAI,KAAK,KAAK;YACnC,uDAAuD;YACvD,MAAM,IAAI,MAAM;QACpB;QAEA,IAAI,CAAC,WAAW,GAAG,KAAK,IAAI,CAAC,WAAW;QACxC,IAAI,CAAC,YAAY,GAAG,KAAK,IAAI,CAAC,YAAY;QAC1C,IAAI,CAAC,iBAAiB,GAAG,IAAI,KAAK,KAAK,IAAI,CAAC,qBAAqB;QACjE,IAAI,CAAC,kBAAkB,GAAG,IAAI,KAAK,KAAK,IAAI,CAAC,sBAAsB;QAEnE,OAAO,KAAK,IAAI;IACpB;IAEA;;KAEC,GACD,MAAM,gBAAuC;QACzC,MAAM,WAAW,MAAM,IAAI,CAAC,OAAO,CAAe,wBAAwB;YACtE,QAAQ;QACZ;QACA,OAAO,SAAS,IAAI;IACxB;IAEA;;KAEC,GACD,MAAM,eAAe,SAA8B,CAAC,CAAC,EAAkC;QACnF,MAAM,cAAc,IAAI;QAExB,IAAI,OAAO,IAAI,EAAE,YAAY,MAAM,CAAC,QAAQ,OAAO,IAAI,CAAC,QAAQ;QAChE,IAAI,OAAO,IAAI,EAAE,YAAY,MAAM,CAAC,QAAQ,OAAO,IAAI,CAAC,QAAQ;QAChE,IAAI,OAAO,OAAO,EAAE,YAAY,MAAM,CAAC,WAAW,OAAO,OAAO;QAChE,IAAI,OAAO,UAAU,EAAE,YAAY,MAAM,CAAC,cAAc,OAAO,UAAU;QACzE,IAAI,OAAO,QAAQ,EAAE,YAAY,MAAM,CAAC,YAAY,OAAO,QAAQ,CAAC,QAAQ;QAC5E,IAAI,OAAO,QAAQ,EAAE,YAAY,MAAM,CAAC,YAAY,OAAO,QAAQ,CAAC,QAAQ;QAC5E,IAAI,OAAO,WAAW,EAAE,YAAY,MAAM,CAAC,eAAe,OAAO,WAAW;QAC5E,IAAI,OAAO,IAAI,EAAE,YAAY,MAAM,CAAC,QAAQ,OAAO,IAAI;QAEvD,MAAM,WAAW,MAAM,IAAI,CAAC,OAAO,CAC/B,CAAC,gBAAgB,EAAE,YAAY,QAAQ,IAAI,EAC3C;YAAE,QAAQ;QAAM;QAEpB,OAAO,SAAS,IAAI;IACxB;IAEA;;KAEC,GACD,MAAM,kBAAkB,GAAW,EAA6B;QAC5D,MAAM,WAAW,MAAM,IAAI,CAAC,OAAO,CAC/B,CAAC,mBAAmB,EAAE,KAAK,EAC3B;YAAE,QAAQ;QAAM;QAEpB,OAAO,SAAS,IAAI;IACxB;IAEA;;KAEC,GACD,MAAM,cAAc,SAA6D,CAAC,CAAC,EAAkC;QACjH,MAAM,cAAc,IAAI;QAExB,IAAI,OAAO,IAAI,EAAE,YAAY,MAAM,CAAC,QAAQ,OAAO,IAAI,CAAC,QAAQ;QAChE,IAAI,OAAO,IAAI,EAAE,YAAY,MAAM,CAAC,QAAQ,OAAO,IAAI,CAAC,QAAQ;QAChE,IAAI,OAAO,OAAO,EAAE,YAAY,MAAM,CAAC,WAAW,OAAO,OAAO;QAEhE,MAAM,WAAW,MAAM,IAAI,CAAC,OAAO,CAC/B,CAAC,yBAAyB,EAAE,YAAY,QAAQ,IAAI,EACpD;YAAE,QAAQ;QAAM;QAEpB,OAAO,SAAS,IAAI;IACxB;IAEA;;KAEC,GACD,MAAM,gBAAgB,SAAiB,EAAoB;QACvD,MAAM,WAAW,MAAM,IAAI,CAAC,OAAO,CAC/B,sBACA;YACI,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;YAAU;QACrC;QAEJ,OAAO,SAAS,MAAM;IAC1B;IAEA;;KAEC,GACD,MAAM,aAAa,UAAoB,EAA0B;QAC7D,MAAM,WAAW,MAAM,IAAI,CAAC,OAAO,CAC/B,4BACA;YACI,QAAQ;YACR,MAAM,KAAK,SAAS,CAAC;gBAAE;YAAW;QACtC;QAEJ,OAAO,SAAS,IAAI;IACxB;IAEA;;KAEC,GACD,UAAU,WAAmB,EAAE,YAAqB,EAAQ;QACxD,IAAI,CAAC,WAAW,GAAG;QACnB,IAAI,cAAc;YACd,IAAI,CAAC,YAAY,GAAG;QACxB;IACJ;AACJ;AAGO,MAAM,WAAW,IAAI"}},
    {"offset": {"line": 324, "column": 0}, "map": {"version":3,"sources":["file:///Users/dasmesh/Documents/Git%20Hub/dropship-store/lib/firebase.ts"],"sourcesContent":["import { initializeApp, getApps } from 'firebase/app';\nimport { getAuth } from 'firebase/auth';\nimport { getFirestore } from 'firebase/firestore';\n\nconst firebaseConfig = {\n    apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\n    authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\n    projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\n    storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\n    messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\n    appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\n    measurementId: process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID,\n};\n\n// Initialize Firebase\nconst app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];\nconst auth = getAuth(app);\nconst db = getFirestore(app);\n\nexport { app, auth, db };\n"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AACA;AAAA;AACA;AAAA;;;;AAEA,MAAM,iBAAiB;IACnB,MAAM;IACN,UAAU;IACV,SAAS;IACT,aAAa;IACb,iBAAiB;IACjB,KAAK;IACL,aAAa;AACjB;AAEA,sBAAsB;AACtB,MAAM,MAAM,IAAA,6KAAO,IAAG,MAAM,KAAK,IAAI,IAAA,mLAAa,EAAC,kBAAkB,IAAA,6KAAO,GAAE,CAAC,EAAE;AACjF,MAAM,OAAO,IAAA,+KAAO,EAAC;AACrB,MAAM,KAAK,IAAA,mLAAY,EAAC"}},
    {"offset": {"line": 359, "column": 0}, "map": {"version":3,"sources":["file:///Users/dasmesh/Documents/Git%20Hub/dropship-store/lib/types/product.ts"],"sourcesContent":["// Product types for Dripzy store\n// These are used for products imported from CJ Dropshipping and stored in Firebase\n\nexport interface ProductVariant {\n    id: string;\n    name: string;\n    sku: string;\n    key: string; // e.g., \"Black\", \"Large\", etc.\n    price: number;\n    compareAtPrice?: number;\n    costPrice: number; // CJ price\n    weight: number;\n    dimensions?: {\n        length: number;\n        width: number;\n        height: number;\n    };\n    stock: number;\n    image?: string;\n}\n\nexport interface ProductImage {\n    id: string;\n    url: string;\n    alt: string;\n    position: number;\n}\n\nexport interface Product {\n    id: string;\n    // Basic Info\n    name: string;\n    slug: string;\n    sku: string;\n    description: string;\n    shortDescription?: string;\n\n    // Pricing\n    price: number;\n    compareAtPrice?: number;\n    costPrice: number; // CJ price for margin calculation\n    currency: string;\n\n    // Media\n    images: ProductImage[];\n    featuredImage: string;\n\n    // Categorization\n    category: string;\n    categoryId: string;\n    subcategory?: string;\n    tags: string[];\n\n    // Variants\n    variants: ProductVariant[];\n    hasVariants: boolean;\n\n    // Inventory\n    stock: number;\n    trackInventory: boolean;\n    lowStockThreshold: number;\n\n    // CJ Dropshipping Reference\n    cjProductId: string;\n    cjSku: string;\n    cjSupplierId?: string;\n    cjDeliveryCycle?: string;\n\n    // Status\n    status: 'active' | 'draft' | 'archived';\n    isVisible: boolean;\n    isFeatured: boolean;\n\n    // SEO\n    seoTitle?: string;\n    seoDescription?: string;\n\n    // Timestamps\n    createdAt: Date;\n    updatedAt: Date;\n    publishedAt?: Date;\n}\n\n// Helper function to generate slug from product name\nexport function generateSlug(name: string): string {\n    return name\n        .toLowerCase()\n        .replace(/[^a-z0-9]+/g, '-')\n        .replace(/(^-|-$)/g, '');\n}\n\n// Helper to calculate suggested retail price from CJ cost\nexport function calculateRetailPrice(costPrice: number, marginPercent: number = 50): number {\n    return Math.ceil(costPrice * (1 + marginPercent / 100));\n}\n\n// Convert CJ product to Dripzy product format\nexport function convertCJProductToProduct(\n    cjProduct: {\n        pid: string;\n        productNameEn: string;\n        productSku: string;\n        productImage: string;\n        sellPrice: number;\n        description: string;\n        categoryName: string;\n        categoryId: string;\n        variants?: {\n            vid: string;\n            variantNameEn: string;\n            variantSku: string;\n            variantKey: string;\n            variantSellPrice: number;\n            variantWeight: number;\n            variantLength?: number;\n            variantWidth?: number;\n            variantHeight?: number;\n            inventories?: { totalInventory: number }[];\n        }[];\n    },\n    marginPercent: number = 50\n): Omit<Product, 'id' | 'createdAt' | 'updatedAt'> {\n    const costPrice = cjProduct.sellPrice;\n    const retailPrice = calculateRetailPrice(costPrice, marginPercent);\n\n    const variants: ProductVariant[] = cjProduct.variants?.map((v, index) => ({\n        id: v.vid,\n        name: v.variantNameEn,\n        sku: v.variantSku,\n        key: v.variantKey,\n        price: calculateRetailPrice(v.variantSellPrice, marginPercent),\n        costPrice: v.variantSellPrice,\n        weight: v.variantWeight,\n        dimensions: v.variantLength ? {\n            length: v.variantLength,\n            width: v.variantWidth || 0,\n            height: v.variantHeight || 0,\n        } : undefined,\n        stock: v.inventories?.[0]?.totalInventory || 0,\n    })) || [];\n\n    const totalStock = variants.reduce((sum, v) => sum + v.stock, 0) || 100;\n\n    return {\n        name: cjProduct.productNameEn,\n        slug: generateSlug(cjProduct.productNameEn),\n        sku: cjProduct.productSku,\n        description: cjProduct.description || '',\n\n        price: retailPrice,\n        compareAtPrice: Math.ceil(retailPrice * 1.2), // 20% higher compare price\n        costPrice: costPrice,\n        currency: 'INR',\n\n        images: [{\n            id: '1',\n            url: cjProduct.productImage,\n            alt: cjProduct.productNameEn,\n            position: 0,\n        }],\n        featuredImage: cjProduct.productImage,\n\n        category: cjProduct.categoryName?.split('/')[0]?.trim() || 'General',\n        categoryId: cjProduct.categoryId,\n        tags: [],\n\n        variants: variants,\n        hasVariants: variants.length > 1,\n\n        stock: totalStock,\n        trackInventory: true,\n        lowStockThreshold: 10,\n\n        cjProductId: cjProduct.pid,\n        cjSku: cjProduct.productSku,\n\n        status: 'draft',\n        isVisible: false,\n        isFeatured: false,\n    };\n}\n"],"names":[],"mappings":"AAAA,iCAAiC;AACjC,mFAAmF;;;;;;;;;AAmF5E,SAAS,aAAa,IAAY;IACrC,OAAO,KACF,WAAW,GACX,OAAO,CAAC,eAAe,KACvB,OAAO,CAAC,YAAY;AAC7B;AAGO,SAAS,qBAAqB,SAAiB,EAAE,gBAAwB,EAAE;IAC9E,OAAO,KAAK,IAAI,CAAC,YAAY,CAAC,IAAI,gBAAgB,GAAG;AACzD;AAGO,SAAS,0BACZ,SAqBC,EACD,gBAAwB,EAAE;IAE1B,MAAM,YAAY,UAAU,SAAS;IACrC,MAAM,cAAc,qBAAqB,WAAW;IAEpD,MAAM,WAA6B,UAAU,QAAQ,EAAE,IAAI,CAAC,GAAG,QAAU,CAAC;YACtE,IAAI,EAAE,GAAG;YACT,MAAM,EAAE,aAAa;YACrB,KAAK,EAAE,UAAU;YACjB,KAAK,EAAE,UAAU;YACjB,OAAO,qBAAqB,EAAE,gBAAgB,EAAE;YAChD,WAAW,EAAE,gBAAgB;YAC7B,QAAQ,EAAE,aAAa;YACvB,YAAY,EAAE,aAAa,GAAG;gBAC1B,QAAQ,EAAE,aAAa;gBACvB,OAAO,EAAE,YAAY,IAAI;gBACzB,QAAQ,EAAE,aAAa,IAAI;YAC/B,IAAI;YACJ,OAAO,EAAE,WAAW,EAAE,CAAC,EAAE,EAAE,kBAAkB;QACjD,CAAC,MAAM,EAAE;IAET,MAAM,aAAa,SAAS,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,KAAK,EAAE,MAAM;IAEpE,OAAO;QACH,MAAM,UAAU,aAAa;QAC7B,MAAM,aAAa,UAAU,aAAa;QAC1C,KAAK,UAAU,UAAU;QACzB,aAAa,UAAU,WAAW,IAAI;QAEtC,OAAO;QACP,gBAAgB,KAAK,IAAI,CAAC,cAAc;QACxC,WAAW;QACX,UAAU;QAEV,QAAQ;YAAC;gBACL,IAAI;gBACJ,KAAK,UAAU,YAAY;gBAC3B,KAAK,UAAU,aAAa;gBAC5B,UAAU;YACd;SAAE;QACF,eAAe,UAAU,YAAY;QAErC,UAAU,UAAU,YAAY,EAAE,MAAM,IAAI,CAAC,EAAE,EAAE,UAAU;QAC3D,YAAY,UAAU,UAAU;QAChC,MAAM,EAAE;QAER,UAAU;QACV,aAAa,SAAS,MAAM,GAAG;QAE/B,OAAO;QACP,gBAAgB;QAChB,mBAAmB;QAEnB,aAAa,UAAU,GAAG;QAC1B,OAAO,UAAU,UAAU;QAE3B,QAAQ;QACR,WAAW;QACX,YAAY;IAChB;AACJ"}},
    {"offset": {"line": 431, "column": 0}, "map": {"version":3,"sources":["file:///Users/dasmesh/Documents/Git%20Hub/dropship-store/app/api/cj/import/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { cjClient } from '@/lib/cj-client';\nimport { db } from '@/lib/firebase';\nimport { collection, addDoc, serverTimestamp, query, where, getDocs } from 'firebase/firestore';\nimport { convertCJProductToProduct, generateSlug } from '@/lib/types/product';\n\nexport async function POST(request: NextRequest) {\n    try {\n        const body = await request.json();\n        const { cjProductId, marginPercent = 50, status = 'draft' } = body;\n\n        if (!cjProductId) {\n            return NextResponse.json(\n                { success: false, error: 'CJ Product ID is required' },\n                { status: 400 }\n            );\n        }\n\n        // Check if product already imported\n        const existingQuery = query(\n            collection(db, 'products'),\n            where('cjProductId', '==', cjProductId)\n        );\n        const existingDocs = await getDocs(existingQuery);\n\n        if (!existingDocs.empty) {\n            return NextResponse.json(\n                { success: false, error: 'Product already imported', existingId: existingDocs.docs[0].id },\n                { status: 409 }\n            );\n        }\n\n        // Fetch product details from CJ\n        const cjProduct = await cjClient.getProductDetails(cjProductId);\n\n        // Convert to our product format\n        const productData = convertCJProductToProduct(\n            {\n                pid: cjProduct.pid,\n                productNameEn: cjProduct.productNameEn,\n                productSku: cjProduct.productSku,\n                productImage: cjProduct.productImage,\n                sellPrice: cjProduct.sellPrice,\n                description: cjProduct.description,\n                categoryName: cjProduct.categoryName,\n                categoryId: cjProduct.categoryId,\n                variants: cjProduct.variants?.map(v => ({\n                    vid: v.vid,\n                    variantNameEn: v.variantNameEn,\n                    variantSku: v.variantSku,\n                    variantKey: v.variantKey,\n                    variantSellPrice: v.variantSellPrice,\n                    variantWeight: v.variantWeight,\n                    variantLength: v.variantLength,\n                    variantWidth: v.variantWidth,\n                    variantHeight: v.variantHeight,\n                    inventories: v.inventories,\n                })),\n            },\n            marginPercent\n        );\n\n        // Override status if provided\n        productData.status = status;\n\n        // Ensure unique slug\n        let slug = productData.slug;\n        let slugCounter = 1;\n        let slugExists = true;\n\n        while (slugExists) {\n            const slugQuery = query(\n                collection(db, 'products'),\n                where('slug', '==', slug)\n            );\n            const slugDocs = await getDocs(slugQuery);\n\n            if (slugDocs.empty) {\n                slugExists = false;\n            } else {\n                slugCounter++;\n                slug = `${productData.slug}-${slugCounter}`;\n            }\n        }\n        productData.slug = slug;\n\n        // Save to Firebase\n        const docRef = await addDoc(collection(db, 'products'), {\n            ...productData,\n            createdAt: serverTimestamp(),\n            updatedAt: serverTimestamp(),\n        });\n\n        return NextResponse.json({\n            success: true,\n            message: 'Product imported successfully',\n            data: {\n                id: docRef.id,\n                name: productData.name,\n                slug: productData.slug,\n                price: productData.price,\n                costPrice: productData.costPrice,\n                status: productData.status,\n            },\n        });\n    } catch (error) {\n        console.error('Error importing CJ product:', error);\n        return NextResponse.json(\n            {\n                success: false,\n                error: error instanceof Error ? error.message : 'Failed to import product'\n            },\n            { status: 500 }\n        );\n    }\n}\n"],"names":[],"mappings":"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"}}]
}