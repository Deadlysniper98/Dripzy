{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/dasmesh/Documents/Git%20Hub/dropship-store/lib/cj-client.ts"],"sourcesContent":["// CJ Dropshipping API Client\n// Documentation: https://developers.cjdropshipping.cn/en/api/introduction.html\n\nconst BASE_URL = 'https://developers.cjdropshipping.com/api2.0/v1';\n\n// Types for CJ API responses\nexport interface CJProduct {\n    id: string;\n    nameEn: string;\n    sku: string;\n    spu: string;\n    bigImage: string;\n    sellPrice: string;\n    nowPrice?: string;\n    discountPrice?: string;\n    discountPriceRate?: string;\n    listedNum: number;\n    categoryId: string;\n    threeCategoryName?: string;\n    twoCategoryName?: string;\n    oneCategoryName?: string;\n    productType: string;\n    supplierName?: string;\n    warehouseInventoryNum?: number;\n    currency?: string;\n    description?: string;\n    deliveryCycle?: string;\n}\n\nexport interface CJProductDetails {\n    pid: string;\n    productName: string;\n    productNameEn: string;\n    productSku: string;\n    productImage: string;\n    productWeight: string;\n    productUnit: string;\n    productType: string;\n    categoryId: string;\n    categoryName: string;\n    sellPrice: number;\n    description: string;\n    suggestSellPrice: string;\n    listedNum: number;\n    status: string;\n    variants: CJVariant[];\n    createrTime: string;\n}\n\nexport interface CJVariant {\n    vid: string;\n    pid: string;\n    variantNameEn: string;\n    variantSku: string;\n    variantKey: string;\n    variantLength: number;\n    variantWidth: number;\n    variantHeight: number;\n    variantWeight: number;\n    variantSellPrice: number;\n    variantSugSellPrice?: number;\n    inventories?: CJInventory[];\n}\n\nexport interface CJInventory {\n    countryCode: string;\n    totalInventory: number;\n    cjInventory: number;\n    factoryInventory: number;\n}\n\nexport interface CJCategory {\n    categoryFirstName: string;\n    categoryFirstList: {\n        categorySecondName: string;\n        categorySecondList: {\n            categoryId: string;\n            categoryName: string;\n        }[];\n    }[];\n}\n\nexport interface CJAuthTokens {\n    accessToken: string;\n    accessTokenExpiryDate: string;\n    refreshToken: string;\n    refreshTokenExpiryDate: string;\n    createDate: string;\n    openId?: number;\n}\n\nexport interface CJApiResponse<T> {\n    code: number;\n    result: boolean;\n    message: string;\n    data: T;\n    requestId: string;\n    success?: boolean;\n}\n\nexport interface CJProductListResponse {\n    pageSize: number;\n    pageNumber: number;\n    totalRecords: number;\n    totalPages: number;\n    content: {\n        productList: CJProduct[];\n        relatedCategoryList?: { categoryId: string; categoryName: string }[];\n        keyWord?: string;\n    }[];\n}\n\nexport interface ProductSearchParams {\n    page?: number;\n    size?: number;\n    keyWord?: string;\n    categoryId?: string;\n    minPrice?: number;\n    maxPrice?: number;\n    countryCode?: string;\n    sort?: 'priceAsc' | 'priceDesc' | 'listedNumDesc' | 'createAtDesc';\n}\n\nclass CJDropshippingClient {\n    private accessToken: string;\n    private refreshToken: string;\n    private accessTokenExpiry: Date | null;\n    private refreshTokenExpiry: Date | null;\n    private apiKey: string;\n\n    constructor() {\n        this.accessToken = process.env.CJ_ACCESS_TOKEN || '';\n        this.refreshToken = process.env.CJ_REFRESH_TOKEN || '';\n        this.apiKey = process.env.CJ_API_KEY || '';\n        this.accessTokenExpiry = process.env.CJ_ACCESS_TOKEN_EXPIRY\n            ? new Date(process.env.CJ_ACCESS_TOKEN_EXPIRY)\n            : null;\n        this.refreshTokenExpiry = process.env.CJ_REFRESH_TOKEN_EXPIRY\n            ? new Date(process.env.CJ_REFRESH_TOKEN_EXPIRY)\n            : null;\n    }\n\n    /**\n     * Make an authenticated request to CJ API\n     */\n    private async request<T>(\n        endpoint: string,\n        options: RequestInit = {}\n    ): Promise<CJApiResponse<T>> {\n        // Check if we need to refresh the token\n        if (this.shouldRefreshToken()) {\n            await this.refreshAccessToken();\n        }\n\n        if (!this.accessToken) {\n            throw new Error('CJ_ACCESS_TOKEN is not configured. Please add your CJ API credentials to .env.local');\n        }\n\n        const url = endpoint.startsWith('http') ? endpoint : `${BASE_URL}${endpoint}`;\n\n        const res = await fetch(url, {\n            ...options,\n            headers: {\n                'CJ-Access-Token': this.accessToken,\n                'Content-Type': 'application/json',\n                ...options.headers,\n            },\n        });\n\n        const data = await res.json();\n\n        if (!res.ok || data.code !== 200) {\n            console.error('CJ API Error:', data);\n            throw new Error(data.message || `CJ API Error: ${res.statusText}`);\n        }\n\n        return data;\n    }\n\n    /**\n     * Check if access token needs refresh (within 1 day of expiry)\n     */\n    private shouldRefreshToken(): boolean {\n        if (!this.accessTokenExpiry) return false;\n        const oneDayFromNow = new Date(Date.now() + 24 * 60 * 60 * 1000);\n        return this.accessTokenExpiry < oneDayFromNow;\n    }\n\n    /**\n     * Get new access token using API key\n     */\n    async getAccessToken(): Promise<CJAuthTokens> {\n        if (!this.apiKey) {\n            throw new Error('CJ_API_KEY is not configured');\n        }\n\n        const res = await fetch(`${BASE_URL}/authentication/getAccessToken`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({ apiKey: this.apiKey }),\n        });\n\n        const data: CJApiResponse<CJAuthTokens> = await res.json();\n\n        if (!data.result || data.code !== 200) {\n            throw new Error(data.message || 'Failed to get access token');\n        }\n\n        this.accessToken = data.data.accessToken;\n        this.refreshToken = data.data.refreshToken;\n        this.accessTokenExpiry = new Date(data.data.accessTokenExpiryDate);\n        this.refreshTokenExpiry = new Date(data.data.refreshTokenExpiryDate);\n\n        return data.data;\n    }\n\n    /**\n     * Refresh access token using refresh token\n     */\n    async refreshAccessToken(): Promise<CJAuthTokens> {\n        if (!this.refreshToken) {\n            throw new Error('No refresh token available. Please get a new access token.');\n        }\n\n        const res = await fetch(`${BASE_URL}/authentication/refreshAccessToken`, {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({ refreshToken: this.refreshToken }),\n        });\n\n        const data: CJApiResponse<CJAuthTokens> = await res.json();\n\n        if (!data.result || data.code !== 200) {\n            // Refresh token may be expired, need to get new tokens\n            throw new Error('Refresh token expired. Please get a new access token using API key.');\n        }\n\n        this.accessToken = data.data.accessToken;\n        this.refreshToken = data.data.refreshToken;\n        this.accessTokenExpiry = new Date(data.data.accessTokenExpiryDate);\n        this.refreshTokenExpiry = new Date(data.data.refreshTokenExpiryDate);\n\n        return data.data;\n    }\n\n    /**\n     * Get product categories from CJ\n     */\n    async getCategories(): Promise<CJCategory[]> {\n        const response = await this.request<CJCategory[]>('/product/getCategory', {\n            method: 'GET',\n        });\n        return response.data;\n    }\n\n    /**\n     * Search/List products using V2 API (better performance with Elasticsearch)\n     */\n    async searchProducts(params: ProductSearchParams = {}): Promise<CJProductListResponse> {\n        const queryParams = new URLSearchParams();\n\n        if (params.page) queryParams.append('page', params.page.toString());\n        if (params.size) queryParams.append('size', params.size.toString());\n        if (params.keyWord) queryParams.append('keyWord', params.keyWord);\n        if (params.categoryId) queryParams.append('categoryId', params.categoryId);\n        if (params.minPrice) queryParams.append('minPrice', params.minPrice.toString());\n        if (params.maxPrice) queryParams.append('maxPrice', params.maxPrice.toString());\n        if (params.countryCode) queryParams.append('countryCode', params.countryCode);\n        if (params.sort) queryParams.append('sort', params.sort);\n\n        const response = await this.request<CJProductListResponse>(\n            `/product/listV2?${queryParams.toString()}`,\n            { method: 'GET' }\n        );\n        return response.data;\n    }\n\n    /**\n     * Get product details by product ID\n     */\n    async getProductDetails(pid: string): Promise<CJProductDetails> {\n        const response = await this.request<CJProductDetails>(\n            `/product/query?pid=${pid}`,\n            { method: 'GET' }\n        );\n        return response.data;\n    }\n\n    /**\n     * Get list of products saved to \"My Products\" in CJ account\n     */\n    async getMyProducts(params: { page?: number; size?: number; keyword?: string } = {}): Promise<CJProductListResponse> {\n        const queryParams = new URLSearchParams();\n\n        if (params.page) queryParams.append('page', params.page.toString());\n        if (params.size) queryParams.append('size', params.size.toString());\n        if (params.keyword) queryParams.append('keyword', params.keyword);\n\n        const response = await this.request<CJProductListResponse>(\n            `/product/myProduct/query?${queryParams.toString()}`,\n            { method: 'GET' }\n        );\n        return response.data;\n    }\n\n    /**\n     * Add a product to \"My Products\" in CJ account\n     */\n    async addToMyProducts(productId: string): Promise<boolean> {\n        const response = await this.request<{ success: boolean }>(\n            '/product/addToMine',\n            {\n                method: 'POST',\n                body: JSON.stringify({ productId }),\n            }\n        );\n        return response.result;\n    }\n\n    /**\n     * Get product inventory by variant IDs\n     */\n    async getInventory(variantIds: string[]): Promise<CJInventory[]> {\n        const response = await this.request<CJInventory[]>(\n            '/product/inventory/query',\n            {\n                method: 'POST',\n                body: JSON.stringify({ variantIds }),\n            }\n        );\n        return response.data;\n    }\n\n    /**\n     * Update client tokens (e.g., after manual refresh)\n     */\n    setTokens(accessToken: string, refreshToken?: string): void {\n        this.accessToken = accessToken;\n        if (refreshToken) {\n            this.refreshToken = refreshToken;\n        }\n    }\n}\n\n// Singleton instance\nexport const cjClient = new CJDropshippingClient();\n\n// Export class for testing or creating new instances\nexport { CJDropshippingClient };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 234, "column": 0}, "map": {"version":3,"sources":["file:///Users/dasmesh/Documents/Git%20Hub/dropship-store/app/api/cj/products/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { cjClient } from '@/lib/cj-client';\n\nexport async function GET(request: NextRequest) {\n    try {\n        const searchParams = request.nextUrl.searchParams;\n\n        const params = {\n            page: searchParams.get('page') ? parseInt(searchParams.get('page')!) : 1,\n            size: searchParams.get('size') ? parseInt(searchParams.get('size')!) : 20,\n            keyWord: searchParams.get('keyword') || undefined,\n            categoryId: searchParams.get('categoryId') || undefined,\n            minPrice: searchParams.get('minPrice') ? parseFloat(searchParams.get('minPrice')!) : undefined,\n            maxPrice: searchParams.get('maxPrice') ? parseFloat(searchParams.get('maxPrice')!) : undefined,\n            countryCode: searchParams.get('countryCode') || undefined,\n            sort: searchParams.get('sort') as 'priceAsc' | 'priceDesc' | 'listedNumDesc' | 'createAtDesc' | undefined,\n        };\n\n        const products = await cjClient.searchProducts(params);\n\n        return NextResponse.json({\n            success: true,\n            data: products,\n        });\n    } catch (error) {\n        console.error('Error fetching CJ products:', error);\n        return NextResponse.json(\n            {\n                success: false,\n                error: error instanceof Error ? error.message : 'Failed to fetch products'\n            },\n            { status: 500 }\n        );\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB;IAC1C,IAAI;QACA,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QAEjD,MAAM,SAAS;YACX,MAAM,aAAa,GAAG,CAAC,UAAU,SAAS,aAAa,GAAG,CAAC,WAAY;YACvE,MAAM,aAAa,GAAG,CAAC,UAAU,SAAS,aAAa,GAAG,CAAC,WAAY;YACvE,SAAS,aAAa,GAAG,CAAC,cAAc;YACxC,YAAY,aAAa,GAAG,CAAC,iBAAiB;YAC9C,UAAU,aAAa,GAAG,CAAC,cAAc,WAAW,aAAa,GAAG,CAAC,eAAgB;YACrF,UAAU,aAAa,GAAG,CAAC,cAAc,WAAW,aAAa,GAAG,CAAC,eAAgB;YACrF,aAAa,aAAa,GAAG,CAAC,kBAAkB;YAChD,MAAM,aAAa,GAAG,CAAC;QAC3B;QAEA,MAAM,WAAW,MAAM,iIAAQ,CAAC,cAAc,CAAC;QAE/C,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,MAAM;QACV;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CACpB;YACI,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}